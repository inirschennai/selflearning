<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
  <g:evaluate var="jvar_groups" object="true" jelly="true">
    var cl = new GlideChoiceList();
    var gr = new GlideRecord('sys_user_group');
    gr.addActiveQuery();
    gr.query();
    while (gr.next()) {
      cl.add(gr.getValue('sys_id'), gr.getValue('name'));
    }
    cl;
  </g:evaluate>

  <div id="groups_display">
    <select id='group_select' class="form-control widget-content select2" onchange="publishFilter()">
      <option value="">Select a Group</option>
      <g:options choiceList="${jvar_groups}" />
    </select>
  </div>

   <script>

    // Initialize Select2 on the dropdown
    $j(document).ready(function() {
      $j('#group_select').select2({
        placeholder: "Select a Group",
        allowClear: true
      });
    });

    var my_dashboardMessageHandler = new DashboardMessageHandler("task_updated_by_filter");

    function publishFilter() {
      var filter_message = {};
      filter_message.id = "task_updated_by_filter";
      filter_message.table = "u_audit_history_catalog_task_assignment_group";

	  var group = $j('#group_select').val();

      if (group == "") {
        clearFilter();
      } else {
        // This filter searche  for the partial match in the field....
        filter_message.filter = 'newgroup_sys_idLIKE' + group + '^ORoldgroup_sys_idLIKE' + group;
      }

      SNC.canvas.interactiveFilters.setDefaultValue({
        id: filter_message.id,
        filters: [filter_message]
      }, false);

      my_dashboardMessageHandler.publishFilter(filter_message.table, filter_message.filter);
    }

    function clearFilter() {
      var filter_message = {};
      filter_message.id = "task_updated_by_filter";
      filter_message.table = "u_audit_history_catalog_task_assignment_group";
      filter_message.filter = "";

      SNC.canvas.interactiveFilters.setDefaultValue({
        id: filter_message.id,
        filters: [filter_message]
      }, false);

      my_dashboardMessageHandler.removeFilter();
    }
  </script>
</j:jelly>
