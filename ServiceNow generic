<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
  <g:evaluate var="jvar_groups" object="false" jelly="true">
    <![CDATA[
    var cl = new GlideChoiceList();
    var gr = new GlideRecord('sys_user_group');
    gr.addActiveQuery();
    gr.query();
    while(gr.next()) {
      cl.add(gr.getValue('sys_id'), gr.getDisplayValue());
    }
    cl;
    ]]>
  </g:evaluate>

  <div id="groups_display">
    <select id='group_select' class="form-control widget-content select2" onchange="filter_group()">
      <option value="">Select a Group</option>
      <j:forEach var="option" items="${jvar_groups.getChoices()}">
        <option value="${option.getValue()}">${option.getLabel()}</option>
      </j:forEach>
    </select>
  </div>

  <script>
    function filter_group() {
      var dbh = new DashboardMessageHandler("filter_group");
      var group = document.getElementById('group_select').value;
      if (group) {
        dbh.publishFilter('u_audit_history_catalog_task_assignment_group', 'oldgroup_nameLIKE' + group);
      } else {
        dbh.removeFilter();
      }
    }
  </script>
</j:jelly>
