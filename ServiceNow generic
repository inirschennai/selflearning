// Function to get sys_id based on display value
function getSysIdByDisplayValue(tableName, displayValue, displayField) {
    var gr = new GlideRecord(tableName);
    gr.addQuery(displayField, displayValue);
    gr.query();
    if (gr.next()) {
        return gr.sys_id.toString();
    } else {
        return null; // No record found
    }
}

// Example usage
var tableName = 'cmdb_ci'; // Replace with your referenced table name
var displayValue = 'My CI Name'; // Replace with your display value
var displayField = 'name'; // Replace with your display field

var sysId = getSysIdByDisplayValue(tableName, displayValue, displayField);

if (sysId) {
    var gr = new GlideRecord('sc_req_item'); // Replace with your catalog item table
    if (gr.get('sys_id_of_catalog_item')) { // Replace with the sys_id of the catalog item
        gr.u_reference_field = sysId; // Replace with your reference field name
        gr.update();
        gs.info('Reference field set successfully');
    } else {
        gs.info('Catalog item not found');
    }
} else {
    gs.info('Referenced record not found');
}

(function process(/*RESTAPIRequest*/ request, /*RESTAPIResponse*/ response) {

    // implement resource here
	var arr = [];
	var params = request.pathParams;
	var user_sys_id = params.user_sys_id;
	var sarecords = params.records;
	gs.log("User: " + user_sys_id);
	gs.log("Records: " + sarecords);
	response.setBody({'User': user_sys_id, 'Records': sarecords});	
	
	var cartId = GlideGuid.generate(null);
	var cart = new Cart(cartId);

	//add your requested item to the cart by sys_id of the catalog item
	var item = cart.addItem('ad4c3cef1baedd10f367fe6edd4bcbc1', 1);

	//fill in the variables on the request item form
	cart.setVariable(item,"requested_by", user_sys_id); 
	cart.setVariable(item,"what_are_the_service_acccount_that_need_to_be_certified", sarecords);
	var rc = cart.placeOrder();

})(request, response);


