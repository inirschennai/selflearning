(function process(/*RESTAPIRequest*/ request, /*RESTAPIResponse*/ response) {
    // Extract parameters from the request
    var params = request.body.data;
    var itemName = params.itemName;
    var itemDescription = params.itemDescription;
    var itemPrice = params.itemPrice;

    // Create a new cart
    var cart = new Cart();
    var cartItem = cart.addItem('YOUR_CATALOG_ITEM_SYS_ID'); // Replace with your catalog item sys_id

    // Set variables for the catalog item
    cart.setVariable(cartItem, 'itemName', itemName);
    cart.setVariable(cartItem, 'itemDescription', itemDescription);
    cart.setVariable(cartItem, 'itemPrice', itemPrice);

    // Submit the cart and generate the RITM
    var cartId = cart.placeOrder();
    var ritm = new GlideRecord('sc_req_item');
    ritm.addQuery('request', cartId);
    ritm.query();

    if (ritm.next()) {
        // Set the response object
        var responseData = {
            status: 'success',
            message: 'Catalog item and RITM created successfully',
            ritmNumber: ritm.getValue('number'),
            ritmUrl: gs.getProperty('glide.servlet.uri') + 'sc_req_item.do?sys_id=' + ritm.getUniqueValue()
        };
        response.setStatus(201); // Created
        response.setBody(responseData);
    } else {
        // Handle the error case for RITM creation
        var errorData = {
            status: 'error',
            message: 'Failed to create RITM'
        };
        response.setStatus(500); // Internal Server Error
        response.setBody(errorData);
    }
})(request, response);

// Function to get sys_id based on display value
function getSysIdByDisplayValue(tableName, displayValue, displayField) {
    var gr = new GlideRecord(tableName);
    gr.addQuery(displayField, displayValue);
    gr.query();
    if (gr.next()) {
        return gr.sys_id.toString();
    } else {
        return null; // No record found
    }
}

// Example usage
var tableName = 'cmdb_ci'; // Replace with your referenced table name
var displayValue = 'My CI Name'; // Replace with your display value
var displayField = 'name'; // Replace with your display field

var sysId = getSysIdByDisplayValue(tableName, displayValue, displayField);

if (sysId) {
    var gr = new GlideRecord('sc_req_item'); // Replace with your catalog item table
    if (gr.get('sys_id_of_catalog_item')) { // Replace with the sys_id of the catalog item
        gr.u_reference_field = sysId; // Replace with your reference field name
        gr.update();
        gs.info('Reference field set successfully');
    } else {
        gs.info('Catalog item not found');
    }
} else {
    gs.info('Referenced record not found');
}

(function process(/*RESTAPIRequest*/ request, /*RESTAPIResponse*/ response) {

    // implement resource here
	var arr = [];
	var params = request.pathParams;
	var user_sys_id = params.user_sys_id;
	var sarecords = params.records;
	gs.log("User: " + user_sys_id);
	gs.log("Records: " + sarecords);
	response.setBody({'User': user_sys_id, 'Records': sarecords});	
	
	var cartId = GlideGuid.generate(null);
	var cart = new Cart(cartId);

	//add your requested item to the cart by sys_id of the catalog item
	var item = cart.addItem('ad4c3cef1baedd10f367fe6edd4bcbc1', 1);

	//fill in the variables on the request item form
	cart.setVariable(item,"requested_by", user_sys_id); 
	cart.setVariable(item,"what_are_the_service_acccount_that_need_to_be_certified", sarecords);
	var rc = cart.placeOrder();

})(request, response);


