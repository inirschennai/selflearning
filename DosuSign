{
    "status": "sent",
    "templateId": "21c78170-35c9-44bc-a2d3-27fced71d198",
    "templateRoles": [
        {
            "roleName": "Approver",
            "email": "srini.parthasarathy@outlook.com",
            "name": "Srini Parthasarathy",
            "tabs": {
                "textTabs": [
                    {
                        "tabLabel": "Software Requested",
                        "value": "Microsoft Visio"
                    },
                    {
                        "tabLabel": "Requester",
                        "value": "Srini Parthasarathy"
                    }
                ]   
            }                
        }            
    ]
}

https://account-d.docusign.com/oauth/auth?response_type=code&scope=signature&client_id=d9cd1e1f-ca81-455e-b903-fdd4e8313c28&redirect_uri=https://www.example.com/callback


(function process(/*RESTAPIRequest*/ request, /*RESTAPIResponse*/ response) {

    var params = request.pathParams;
    var client_id = params.client_id;
    var client_secret = params.client_secret;
    var callback_url = params.callback_url;
    var account_id = params.account_id;    
    var requested_software = params.requested_software;
    var requester = params.requester;
    var approvername = params.approvername;
    var approveremail = params.approveremail;    
    var refresh_token = params.refresh_token; // assuming refresh token is passed in params

    var tokenUrl = 'https://account-d.docusign.com/oauth/token';
    var envelopeUrl = `https://demo.docusign.net/restapi/v2.1/accounts/${account_id}/envelopes`;

    // Step 1: Get access token using refresh token
    var tokenRequest = new sn_ws.RESTMessageV2();
    tokenRequest.setHttpMethod('post');
    tokenRequest.setEndpoint(tokenUrl);
    tokenRequest.setQueryParameter('grant_type', 'refresh_token');
    tokenRequest.setQueryParameter('refresh_token', refresh_token);
    tokenRequest.setQueryParameter('client_id', client_id);
    tokenRequest.setQueryParameter('client_secret', client_secret);
    var tokenResponse = tokenRequest.execute();
    var tokenResponseBody = tokenResponse.getBody();
    var tokenResponseData = JSON.parse(tokenResponseBody);
    var accessToken = tokenResponseData.access_token;

    // Step 2: Call envelope endpoint
    var envelopeRequest = new sn_ws.RESTMessageV2();
    envelopeRequest.setHttpMethod('post');
    envelopeRequest.setEndpoint(envelopeUrl);
    envelopeRequest.setRequestHeader('Authorization', 'Bearer ' + accessToken);
    envelopeRequest.setRequestBody({
        "status": "sent",
        "emailSubject": "Please approve Software Request via DocuSign",
        "templateId": "21c78170-35c9-44bc-a2d3-27fced71d198",
        "templateRoles": [
            {
                "roleName": "Approver",
                "email": approveremail,
                "name": approvername,
                "tabs": {
                    "textTabs": [
                        {
                            "tabLabel": "Software Requested",
                            "value": requested_software
                        },
                        {   
                            "tabLabel": "Requester",
                            "value": requester
                        }
                    ]   
                }                
            }            
        ]
    });
    var envelopeResponse = envelopeRequest.execute();
    var envelopeResponseBody = envelopeResponse.getBody();
    var envelopeResponseData = JSON.parse(envelopeResponseBody);

    return {
        accessToken: accessToken,
        envelopeResponse: envelopeResponseData
    };
})(request, response);
