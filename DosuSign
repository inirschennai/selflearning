{
    "status": "sent",
    "templateId": "21c78170-35c9-44bc-a2d3-27fced71d198",
    "templateRoles": [
        {
            "roleName": "Approver",
            "email": "srini.parthasarathy@outlook.com",
            "name": "Srini Parthasarathy",
            "tabs": {
                "textTabs": [
                    {
                        "tabLabel": "Software Requested",
                        "value": "Microsoft Visio"
                    },
                    {
                        "tabLabel": "Requester",
                        "value": "Srini Parthasarathy"
                    }
                ]   
            }                
        }            
    ]
}

https://account-d.docusign.com/oauth/auth?response_type=code&scope=signature&client_id=d9cd1e1f-ca81-455e-b903-fdd4e8313c28&redirect_uri=https://www.example.com/callback

Integration key: 13deda28-95e4-4c7b-8303-68cb3e4a24f0
Secret Key: 12444f79-7406-4feb-83e5-0a6c97e84abd

MTNkZWRhMjgtOTVlNC00YzdiLTgzMDMtNjhjYjNlNGEyNGYwOjEyNDQ0Zjc5LTc0MDYtNGZlYi04M2U1LTBhNmM5N2U4NGFiZA==

Integration key: d9cd1e1f-ca81-455e-b903-fdd4e8313c28
Secret Key: 9317fe9b-758a-4281-bd22-569245c5747e

ZDljZDFlMWYtY2E4MS00NTVlLWI5MDMtZmRkNGU4MzEzYzI4OjkzMTdmZTliLTc1OGEtNDI4MS1iZDIyLTU2OTI0NWM1NzQ3ZQ==
ZDljZDFlMWYtY2E4MS00NTVlLWI5MDMtZmRkNGU4MzEzYzI4OjkzMTdmZTliLTc1OGEtNDI4MS1iZDIyLTU2OTI0NWM1NzQ3ZQ==

https://{{hostenv}}/oauth/token

using code and grant_type

var clientId = 'your_client_id';
var clientSecret = 'your_client_secret';
var authCode = 'your_auth_code';
var hostenv = 'your_host_env';

// Create an instance of sn_ws.RESTMessageV2
var restMessage = new sn_ws.RESTMessageV2();

// Set the HTTP method to POST
restMessage.setHttpMethod('post');

// Set the endpoint URL
restMessage.setEndpoint('https://' + hostenv + '/oauth/token');

// Set the request body parameters
restMessage.setRequestBody(JSON.stringify({
    code: authCode,
    grant_type: 'authorization_code',
    client_id: clientId,
    client_secret: clientSecret,
    redirect_uri: 'your_redirect_uri'
}));

// Send the HTTP request and capture the response
var response = restMessage.execute();

// Parse the response body to JSON
var responseBody = JSON.parse(response.getBody());

// Extract the access and refresh tokens
var accessToken = responseBody.access_token;
var refreshToken = responseBody.refresh_token;

// Log the tokens
gs.info('Access Token: ' + accessToken);
gs.info('Refresh Token: ' + refreshToken);


(function process(/*RESTAPIRequest*/ request, /*RESTAPIResponse*/ response) {

    var params = request.pathParams;
    var client_id = params.client_id;
    var client_secret = params.client_secret;
    var account_id = params.account_id;    
    var requested_software = params.requested_software;
    var requester = params.requester;
    var refresh_token = params.refresh_token;  // Assuming the refresh token is passed as a parameter

    var tokenUrl = 'https://account-d.docusign.com/oauth/token';
    var envelopeUrl = 'https://demo.docusign.net/restapi/v2.1/accounts/' + account_id + '/envelopes';
    
    // Step 1: Get access token using refresh token
    var tokenRequest = new sn_ws.RESTMessageV2();
    tokenRequest.setHttpMethod('post');
    tokenRequest.setEndpoint(tokenUrl);
    tokenRequest.setQueryParameter('grant_type', 'refresh_token');
    tokenRequest.setQueryParameter('refresh_token', refresh_token);
    tokenRequest.setQueryParameter('client_id', client_id);
    tokenRequest.setQueryParameter('client_secret', client_secret);
    var tokenResponse = tokenRequest.execute();
    var tokenResponseBody = tokenResponse.getBody();
    var tokenResponseData = JSON.parse(tokenResponseBody);
    var accessToken = tokenResponseData.access_token;
    var refreshToken = tokenResponseData.refresh_token;

    // Step 2: Call envelope endpoint
    var envelopeRequest = new sn_ws.RESTMessageV2();
    envelopeRequest.setHttpMethod('post');
    envelopeRequest.setEndpoint(envelopeUrl);
    envelopeRequest.setRequestHeader('Authorization', 'Bearer ' + accessToken);
    envelopeRequest.setRequestBody({
        "status": "sent",
		"emailSubject": "Please approve Software Request via DocuSign",
		"templateId": "21c78170-35c9-44bc-a2d3-27fced71d198",
		"templateRoles": [
			{
				"roleName": "Approver",
				"email": "srini.parthasarathy@outlook.com",
				"name": "Srini Parthasarathy",
				"tabs": {
					"textTabs": [
						{
							"tabLabel": "Software Requested",
							"value": "Microsoft Visio"
						},
						{	
							"tabLabel": "Requester",
							"value": "Srini Parthasarathy"
						}
					]   
				}                
			}            
		]
    });
    var envelopeResponse = envelopeRequest.execute();
    var envelopeResponseBody = envelopeResponse.getBody();
    var envelopeResponseData = JSON.parse(envelopeResponseBody);

    return {
        accessToken: accessToken,
        refreshToken: refreshToken,
        envelopeResponse: envelopeResponseData
    };
})(request, response);

(function() {
    var client_id = '13deda28-95e4-4c7b-8303-68cb3e4a24f0';
    var client_secret = '12444f79-7406-4feb-83e5-0a6c97e84abd';
    var account_id = 'c9fb8dec-73fa-49b8-af23-06762ff10fd4';    
    var requested_software = 'Microsoft Visio';
    var requester = 'Srini Parthasarathy';
    var refresh_token = 'eyJ0eXAiOiJNVCIsImFsZyI6IlJTMjU2Iiwia2lkIjoiNjgxODVmZjEtNGU1MS00Y2U5LWFmMWMtNjg5ODEyMjAzMzE3In0.AQoAAAABAAgABwAAIUS_d6bcSAgAAKGotwq-3EgCAPBFnxJENkdMudscvAtO_DcVAAEAAAAYAAEAAAAFAAAADQAkAAAAMTNkZWRhMjgtOTVlNC00YzdiLTgzMDMtNjhjYjNlNGEyNGYwIgAkAAAAMTNkZWRhMjgtOTVlNC00YzdiLTgzMDMtNjhjYjNlNGEyNGYwMAAA-l1kdqbcSDcAGmwPV9OKvkSnXLwbyC6tzQ.Hgs7kKc8EtnLsE9zaFvg-CyCe2KmBvb0eRD2HQqh8Xkh2jfHsoZxbTBhXKyGlBNSJPo1EHO35zn-Ll3Ysi6HAfV3B64tlOY0yv3ihKU4qR_f82SBlhyXWHz-6EJ70MdG59Upx3V-YYQePYsiFigi_STudbXTUN6PYhxTfUEJ8-KvGCqYDufTs2gdAE0s6SPmzQFxga18F33nKRsxdDW2tlBX9j5O4gB8UOawWNOK4Rb5nGv9gsws3p05LXSwQabhs1P0Pl6ZmBCr7Mur8IJFyYlzuxUFARrNG4NjMUaIlLcuwSLNFBdiES9es8U_NRnsw_OA5iWTwDwrFmjOhTwgsg';  // Assuming the refresh token is passed as a parameter

    var tokenUrl = 'https://account-d.docusign.com/oauth/token';
    var envelopeUrl = 'https://demo.docusign.net/restapi/v2.1/accounts/' + account_id + '/envelopes';
    
    // Step 1: Get access token using refresh token
    var tokenRequest = new sn_ws.RESTMessageV2();
    tokenRequest.setHttpMethod('post');
    tokenRequest.setEndpoint(tokenUrl);
    tokenRequest.setQueryParameter('grant_type', 'refresh_token');
    tokenRequest.setQueryParameter('refresh_token', refresh_token);
    tokenRequest.setQueryParameter('client_id', client_id);
    tokenRequest.setQueryParameter('client_secret', client_secret);
    var tokenResponse = tokenRequest.execute();
    var tokenResponseBody = tokenResponse.getBody();
    var tokenResponseData = JSON.parse(tokenResponseBody);
    var accessToken = tokenResponseData.access_token;
    var refreshToken = tokenResponseData.refresh_token;
	gs.info('Access Token: ' + accessToken);
    gs.info('Refresh Token: ' + refreshToken);    

    // Step 2: Call envelope endpoint
    var envelopeRequest = new sn_ws.RESTMessageV2();
    envelopeRequest.setHttpMethod('post');
    envelopeRequest.setEndpoint(envelopeUrl);
    envelopeRequest.setRequestHeader('Authorization', 'Bearer ' + accessToken);
    envelopeRequest.setRequestBody(JSON.stringify({
        "status": "sent",
        "emailSubject": "Please approve Software Request via DocuSign",
        "templateId": "21c78170-35c9-44bc-a2d3-27fced71d198",
        "templateRoles": [
            {
                "roleName": "Approver",
                "email": "srini.parthasarathy@outlook.com",
                "name": "Srini Parthasarathy",
                "tabs": {
                    "textTabs": [
                        {
                            "tabLabel": "Software Requested",
                            "value": requested_software
                        },
                        {   
                            "tabLabel": "Requester",
                            "value": requester
                        }
                    ]   
                }                
            }            
        ]
    }));
    var envelopeResponse = envelopeRequest.execute();
    var envelopeResponseBody = envelopeResponse.getBody();
    var envelopeResponseData = JSON.parse(envelopeResponseBody);

    gs.info('Envelope Response: ' + JSON.stringify(envelopeResponseData));
})();
